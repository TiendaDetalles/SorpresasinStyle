<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sorpresas in Style</title>
  <style>
    /* ... (tu CSS exacto, sin cambios) ... */
  </style>
</head>
<body>
  <header>
    <img id="company-logo" src="" alt="Logo de la empresa">
    <h1>Sorpresas in Style</h1>
  </header>

  <div id="filtro-categoria">
    <select id="selector-categoria" onchange="filtrarCategoria()">
      <option value="todas">Todas las categor√≠as</option>
    </select>
  </div>

  <main>
    <section id="productos-container"></section>
    <section id="carrito">
      <h2>Carrito de Compras</h2>
      <ul id="lista-carrito"></ul>
      <p>Total: $<span id="total">0</span></p>
      <button onclick="comprar()">Comprar</button>
    </section>
  </main>

  <!-- Modal admin (sin cambios) -->
  <div id="adminModal" class="modal">
    <!-- ... tu HTML de modal ... -->
  </div>
  <button id="botonAdmin">‚öôÔ∏è</button>

  <!-- Firebase + Realtime Database -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import {
      getDatabase, ref, onValue, push, update, remove
    } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCpHYnWuWp7sb9P-HR6rEMg7fg9Xigl-lA",
      authDomain: "sorpresasinstyle-2664b.firebaseapp.com",
      databaseURL: "https://sorpresasinstyle-2664b-default-rtdb.firebaseio.com",
      projectId: "sorpresasinstyle-2664b",
      storageBucket: "sorpresasinstyle-2664b.firebasestorage.app",
      messagingSenderId: "615713402015",
      appId: "1:615713402015:web:74bcd71e0a22f3815c06aa",
      measurementId: "G-82WQ2NKVLQ"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let productos = [];
    let carrito = JSON.parse(localStorage.getItem("carrito")) || [];
    let categoriaSeleccionada = "todas";

    const productosContainer = document.getElementById("productos-container");
    const productosAgregados = document.getElementById("productos-agregados");
    const selectorCategoria = document.getElementById("selector-categoria");

    // 1. Cargar productos en tiempo real
    const productosRef = ref(db, 'productos');
    onValue(productosRef, snapshot => {
      productos = [];
      snapshot.forEach(child => {
        productos.push({ key: child.key, ...child.val() });
      });
      actualizarVista();
    });

    // 2. Agregar producto (desde el formulario)
    document.getElementById("formulario-producto")
      .addEventListener("submit", e => {
        e.preventDefault();
        const nombre = document.getElementById("nombreProducto").value;
        const precio = document.getElementById("precioProducto").value;
        const categoria = document.getElementById("categoriaProducto").value;
        const imagenFile = document.getElementById("imagenProducto").files[0];
        const reader = new FileReader();
        reader.onloadend = () => {
          push(productosRef, {
            nombre, precio, categoria, imagen: reader.result
          });
        };
        reader.readAsDataURL(imagenFile);
        e.target.reset();
      });

    // 3. Funciones de edici√≥n y borrado
    window.eliminarProducto = key => {
      remove(ref(db, `productos/${key}`));
    };
    window.editarProducto = (key, campo, valor) => {
      update(ref(db, `productos/${key}`), { [campo]: valor });
    };
    window.editarImagen = (key, input) => {
      const file = input.files[0];
      const r = new FileReader();
      r.onloadend = () => {
        update(ref(db, `productos/${key}`), { imagen: r.result });
      };
      r.readAsDataURL(file);
    };

    // 4. Mostrar productos y admin
    function actualizarVista() {
      productosContainer.innerHTML = '';
      productosAgregados.innerHTML = '';
      actualizarSelectorCategorias();

      const lista = categoriaSeleccionada === "todas"
        ? productos
        : productos.filter(p => p.categoria === categoriaSeleccionada);

      lista.forEach(p => {
        productosContainer.innerHTML += `
          <div class="producto-tarjeta">
            <img src="${p.imagen}" class="producto-imagen">
            <div class="producto-nombre">${p.nombre}</div>
            <div class="producto-precio">$${p.precio}</div>
            <div class="producto-categoria">${p.categoria}</div>
            <button class="producto-boton" onclick="agregarAlCarrito('${p.key}')">üõí</button>
          </div>`;
        productosAgregados.innerHTML += `
          <div class="producto-tarjeta">
            <img src="${p.imagen}" class="producto-imagen">
            <input class="input-edit" type="text" value="${p.nombre}"
              onchange="editarProducto('${p.key}', 'nombre', this.value)">
            <input class="input-edit" type="number" value="${p.precio}"
              onchange="editarProducto('${p.key}', 'precio', this.value)">
            <input class="input-edit" type="text" value="${p.categoria}"
              onchange="editarProducto('${p.key}', 'categoria', this.value)">
            <input class="input-edit" type="file" onchange="editarImagen('${p.key}', this)">
            <button class="admin-button" onclick="eliminarProducto('${p.key}')">Eliminar</button>
          </div>`;
      });
    }

    function actualizarSelectorCategorias() {
      const cats = ["todas", ...new Set(productos.map(p => p.categoria))];
      selectorCategoria.innerHTML = cats.map(cat =>
        `<option value="${cat}" ${cat===categoriaSeleccionada?'selected':''}>${cat}</option>`
      ).join('');
    }
    window.filtrarCategoria = () => {
      categoriaSeleccionada = selectorCategoria.value;
      actualizarVista();
    };

    // 5. Carrito (localStorage)
    window.agregarAlCarrito = key => {
      const p = productos.find(x => x.key === key);
      carrito.push(p);
      localStorage.setItem("carrito", JSON.stringify(carrito));
      actualizarCarrito();
    };
    function actualizarCarrito() {
      const ul = document.getElementById("lista-carrito");
      ul.innerHTML = '';
      let total = 0;
      carrito.forEach(p => {
        ul.innerHTML += `<li>${p.nombre} - $${p.precio}</li>`;
        total += parseFloat(p.precio);
      });
      document.getElementById("total").textContent = total.toFixed(2);
    }
    window.comprar = () => {
      if (!carrito.length) return alert("Tu carrito est√° vac√≠o.");
      alert("¬°Gracias por tu compra!");
      carrito = [];
      localStorage.setItem("carrito", "[]");
      actualizarCarrito();
    };

    // Logo en localStorage (igual que antes)
    function cambiarLogo() {
      const f = document.getElementById("logoInput").files[0];
      const r = new FileReader();
      r.onloadend = () => {
        document.getElementById("company-logo").src = r.result;
        localStorage.setItem("logoEmpresa", r.result);
      };
      r.readAsDataURL(f);
    }
    window.cambiarLogo = cambiarLogo;
    function cargarLogo() {
      const l = localStorage.getItem("logoEmpresa");
      if (l) document.getElementById("company-logo").src = l;
    }

    // Inicia todo al cargar p√°gina
    window.onload = () => {
      cargarLogo();
      actualizarCarrito();
    };
  </script>
</body>
</html>
